<!--_meta 作为公共模版分离出去-->
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport"
	content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<base href="${basePath}" />
<LINK rel="Bookmark" href="/favicon.ico">
<LINK rel="Shortcut Icon" href="/favicon.ico" />
<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>
<script type="text/javascript" src="lib/PIE_IE678.js"></script>
<![endif]-->
<link rel="stylesheet" type="text/css"
	href="static/h-ui/css/H-ui.min.css" />
<link rel="stylesheet" type="text/css"
	href="static/h-ui/css/H-ui.admin.css" />
<link rel="stylesheet" type="text/css"
	href="lib/Hui-iconfont/1.0.7/iconfont.css" />
<link rel="stylesheet" type="text/css"
	href="static/h-ui/skin/default/skin.css" id="skin" />
<link rel="stylesheet" type="text/css" href="static/h-ui/css/style.css" />
<link rel="stylesheet" type="text/css" href="lib/MultiDatesPicker/1.6.3/css/jquery-ui.css" />
<style>
table.ui-datepicker-calendar {
	border-collapse: separate;
}

.ui-datepicker-calendar td {
	border: 1px solid transparent;
}
/* begin: jQuery UI Datepicker emphasis on selected dates */
.ui-datepicker .ui-datepicker-calendar .ui-state-highlight a {
	background: #ffe45c none; /* a color that fits the widget theme */
	color: white; /* a color that is readeable with the color above */
}
/* end: jQuery UI Datepicker emphasis on selected dates */
</style>
<!--[if IE 6]>
<script type="text/javascript" src="http://lib.h-ui.net/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
</head>
<body>
	<div class="page-container ">
		<form class="form form-horizontal" id="info">
		<#if type='3'>
			<div id="multi" class="col-sm-4"></div>
		</#if>
			<div class="col-sm-8">
			<#if type!='3'>
				<input name="id" value="${corp.id}" hidden="true"/>
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-4">团期：</label>
					<div class="formControls col-xs-8 col-sm-7">
						<input type="text" class="input-text"
							placeholder="" id="original_price" disabled="disabled" name="original_price" value="${corp.mission_time?if_exists}">
					</div>
					
				</div>
			</#if>
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-4">原价：</label>
					<div class="formControls col-xs-8 col-sm-7">
						<input type="text" class="input-text"
							placeholder="" id="original_price" name="original_price" value="${corp.original_price?if_exists}"  required>
					</div>
					元
				</div>

				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-4">现价：</label>
					<div class="formControls col-xs-8 col-sm-7">
						<input type="text"  class="input-text"
							placeholder="" id="now_the_price" name="now_the_price" value="${corp.now_the_price?if_exists}" required>
					</div>
					元
				</div>
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-4">儿童价：</label>
					<div class="formControls col-xs-8 col-sm-7">
						<input type="text" class="input-text"
							placeholder="" id="child_price" name="child_price" value="${corp.child_price?if_exists}" required> 
					</div>
					元
				</div>
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-4">报名开始提前：</label>
					<div class="formControls col-xs-8 col-sm-7">
						<input type="text"  class="input-text"
							placeholder="" id="sign_up_begin" name="sign_up_begin" value="${corp.sign_up_begin?if_exists}" required>
					</div>
					天
				</div>
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-4">报名结束提前：</label>
					<div class="formControls col-xs-8 col-sm-7">
						<input type="text" class="input-text"
							placeholder="" id="sign_up_end" name="sign_up_end" value="${corp.sign_up_end?if_exists}" required>
					</div>
					天
				</div>
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-4">人数上限：</label>
					<div class="formControls col-xs-8 col-sm-7">
						<input type="text" class="input-text"
							placeholder="" id="stock" name="stock" value="${corp.stock!}" required> 
					</div>
				</div>
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-4">领队：</label>
					<div class="formControls col-xs-6 col-sm-7">
						<input type="text" class="input-text"
							placeholder="" disabled="disabled" id="leader" name="leader" value="${leaders.leader_names?if_exists}" required>
							<input type="text" hidden="true" id="leader_id" name="leader_id" value="${leaders.leader_ids?if_exists}" required>
					</div>
					<#if type!='1'><input class="btn btn-warning radius" type="button" value="编辑" onclick = "leaders()"></#if>
				</div>
			</div>

		</form>
	</div>

	<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script>
	<script type="text/javascript" src="lib/layer/2.1/layer.js"></script>
	<script type="text/javascript" src="static/h-ui/js/H-ui.js"></script>
	<script type="text/javascript" src="static/h-ui/js/H-ui.admin.js"></script>
	<script type="text/javascript" src="lib/jquery.validation/1.14.0/jquery.validate.min.js"></script>
	<script type="text/javascript" src="lib/jquery.validation/1.14.0/validate-methods.js"></script>
	<script type="text/javascript" src="lib/jquery.validation/1.14.0/messages_zh.min.js"></script>

	<!--请在下方写此页面业务相关的脚本-->
	<script type="text/javascript"
		src="lib/MultiDatesPicker/1.6.3/js/jquery-ui-1.11.1.js"></script>
	<script type="text/javascript"
		src="lib/MultiDatesPicker/1.6.3/jquery-ui.multidatespicker.js"></script>

	<script type="text/javascript">
		$(function() {
			window.onunload = function(event) { 
				$("#search_button",parent.document).click();
			}
			<#if type='3'> // 如果是编辑画面的话不显示日期控件
				var times = [];
				<#if existed_times??>
					<#list existed_times as time>
						times.push("${time.mission_time}")
					</#list>
				</#if>
				
				$.datepicker.regional.zh = {
					minDate: 1,
					closeText : "关闭", // Display text for close link
					prevText : "<<", // Display text for previous month link
					nextText: ">>", // Display text for next month link
					monthNames : [ '一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月',
							'九月', '十月', '十－月', '十二月' ], // Names of months for drop-down and formatting
					monthNamesShort : [ "Jan", "Feb", "Mar", "Apr", "May", "Jun",
							"Jul", "Aug", "Sep", "Oct", "Nov", "Dec" ], // For formatting
					dayNames : [ '日', '一', '二', '三', '四', '五', '六' ], // For formatting
					dayNamesShort : [ '日', '一', '二', '三', '四', '五', '六' ], // For formatting
					dayNamesMin : [ '日', '一', '二', '三', '四', '五', '六' ], // Column headings for days starting at Sunday
					weekHeader : "周", // Column header for week of the year
					dateFormat : "yy-mm-dd", // See format options on parseDate
					isRTL : false, // True if right-to-left language, false if left-to-right
					showMonthAfterYear : false, // True if the year select precedes month, false for month then year
					yearSuffix : "" // Additional text to append to the year in the month headers
				}
				
				
			
				$("#multi").multiDatesPicker($.datepicker.regional.zh);
				if(times.length>0)
					$("#multi").multiDatesPicker({
						addDisabledDates: times
					});
				
				$("#multi").multiDatesPicker('resetDates', 'picked');
			</#if>

		});
		
		function create(){
			if(!$("#info").validate({ignore: ".ignore",
				rules: {
				original_price: "number",
			    now_the_price:"number",
			    child_price:"number",
			    stock:"digits",
			    sign_up_begin:"digits",
			    sign_up_end:"digits"
			  }}).form()){
				return;
			}
			var dates = $('#multi').multiDatesPicker('getDates');
			if(!(dates.length>0)){
				layer.msg('请选择团期！', {icon: 2,time:2000});
				return;
			}
			var data = $('#info').serialize()+"&route_id=${route_id}"+"&dates="+dates.join(",");
			$.ajax({
					type:'POST',
					url:"corps/create",
					data : data,
					beforeSend: function(){
						layer.load(2,{zindex:1200});
					},
					success:function(r){
						layer.closeAll('loading');
						if(r.result=="success"){
							parent.layer.msg('操作成功！', {icon: 1,time:2000});
							layer_close();
						}else{
							layer.msg('操作失败！', {icon: 2,time:2000});
						}
					}
				})
		}
		
		function update(){
			if(!$("#info").validate({ignore: ".ignore",
				rules: {
				original_price: "number",
			    now_the_price:"number",
			    child_price:"number",
			    sign_up_begin:"digits",
			    sign_up_end:"digits",
			    stock:"digits"
			  }}).form()){
				return;
			}
			$.ajax({
				type:'POST',
				url:"corps/update",
				data : $('#info').serialize(),
				beforeSend: function(){
					layer.load(2,{zindex:1200});
				},
				success:function(r){
					layer.closeAll('loading');
					if(r.result=="success"){
						parent.layer.msg('操作成功！', {icon: 1,time:2000});
						$('#search_button',parent.document).click();
						//var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
						//parent.layer.close(index); 
					}else{
						layer.msg('操作失败！', {icon: 2,time:2000});
					}
				}
			});
		}
		
		function leaders(){
			var leaders = $('#leader_id').val();
			var index = layer.open({
				type : 2,
				title : "添加领队",
				zindex:2000,
				area:['900px','500px'],
				content : "corps/leader?route_id=${route_id}&club_id=${club_id}&leaders="+leaders
			});
			
		}
		
		function save(){
			if('${type}'=='3'){
				create();
			}else{
				update();
			}
		}
	</script>
	<!--/请在上方写此页面业务相关的脚本-->
	<div style="height:80px;width:100%;float:left;"></div>
	<footer class="footer  pos-f" style = " float:left; bottom:0;z-index:20;width:100%;background-color:#F8F8F8;">
		<div class="row cl" id="buttons">
		<#if type!='1'>
			<button id="saveBtn" type="button" onclick="save()" class="btn btn-primary radius">
				<i class="Hui-iconfont">&#xe632;</i>保存
			</button>
		</#if>
			<button class="btn btn-default radius"
				type="button" onclick="layer_close();">&nbsp;&nbsp;取消&nbsp;&nbsp;</button>
		</div>
	</footer>
</body>
</html>