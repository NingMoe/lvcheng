<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport"
	content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<base href="${basePath}" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>
<script type="text/javascript" src="lib/PIE_IE678.js"></script>
<![endif]-->
<link rel="stylesheet" type="text/css"	href="static/h-ui/css/H-ui.min.css" />
<link rel="stylesheet" type="text/css"	href="static/h-ui/css/H-ui.admin.css" />
<link rel="stylesheet" type="text/css"	href="lib/Hui-iconfont/1.0.7/iconfont.css" />
<link rel="stylesheet" type="text/css"	href="static/h-ui/skin/blue/skin.css" id="skin" />
<link rel="stylesheet" type="text/css"  href="static/h-ui/css/style.css" />
<link rel="stylesheet" type="text/css"  href="lib/wangEditor-2.1.10/dist/css/wangEditor.min.css" />
<!--[if IE 6]>
<script type="text/javascript" src="http://lib.h-ui.net/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
</head>
<body>
	<div id="tab_demo" class="HuiTab"  style="margin-bottom:50px;">
		<div class="tabBar cl pos-f " style="width:100%;z-index:22;background-color:#fff;">
			<span>热门城市</span><span>服务器设置</span><span>服务协议</span><span>隐私条款</span><span>玩法介绍</span><span>标签管理</span><span>app登陆配置</span><span>活动设置</span>
		</div>
		<div style = "min-height:40px"></div>
		<div class="tabCon" >
			<iframe src="setting/hotCity"   frameborder="0"   style="position:absolute;bottom:0;width:100%;height:100%;"></iframe>
		</div>
		<div class="tabCon">
			<div class="page-container">
				<form class="form form-horizontal" id="server_config">
					<div class="row cl">
						<label class="form-label col-sm-2">景点通知推送范围：</label>米
						<div class="formControls col-sm-2">
							<input type="text" id="notice" name="notice"
								class="input-text radius size-M" value="${protocol.notice!}">
						</div>
					</div>
					<div class="row cl">
						<label class="form-label col-sm-2">金币提成系数：</label>
						<div class="formControls col-sm-6">
							<div class="row cl">
								<label class="form-label col-sm-2">一级推荐人</label>%
								<div class="formControls col-sm-2">
									<input type="text" id="one_buddy" name="oneBuddy"
										class="input-text radius size-M"
										value="${protocol.one_buddy!}" required>
								</div>
							</div>
							<div class="row cl">
								<label class="form-label col-sm-2">二级推荐人</label>%
								<div class="formControls col-sm-2">
									<input type="text" id="two_buddy" name="twoBuddy"
										class="input-text radius size-M"
										value="${protocol.two_buddy!}" required>
								</div>
							</div>
							<div class="row cl">
								<label class="form-label col-sm-2">三级推荐人</label>%
								<div class="formControls col-sm-2">
									<input type="text" id="three_buddy" name="threeBuddy"
										class="input-text radius size-M"
										value="${protocol.three_buddy!}" required>
								</div>
							</div>
						</div>
					</div>
					<div class="row cl">
						<label class="form-label col-sm-2">App地图位置刷新频率：</label>
						<div class="formControls col-sm-2">
									<input type="text" id="map_me" name="mapMe"
										class="input-text radius size-M" value="${protocol.map_me!}"
										required>
						</div>
						秒
					</div>
					<div class="footer  pos-f"
						style="bottom: 0; z-index: 20; width: 100%;">
						<div class="row cl" id="buttons">
							<button onClick="saveServerConfig();"
								class="btn btn-primary radius" type="button">
								<i class="Hui-iconfont">&#xe632;</i> 保存
							</button>
						</div>
					</div>
				</form>
			</div>
		</div>
		<div class="tabCon">
			<div class="page-container">
				<form class="form form-horizontal"
					id="server_pact_form>
				<div class=" rowcl">
					<div class="formControls col-xs-8 col-sm-9">
						<div id="server_pact" style="width: 100%; height: 300px;">
							${protocol.server_pact!}
						</div>
					</div>
					<div class="footer  pos-f"
						style="bottom: 0; z-index: 20; width: 100%;">
						<div class="row cl" >
							<button onClick="saveServerPact();"
								class="btn btn-primary radius" type="button">
								<i class="Hui-iconfont">&#xe632;</i> 保存
							</button>
						</div>
					</div>
				</form>
			</div>
		</div>
			<div class="tabCon">
			<div class="page-container">
				<form class="form form-horizontal"
					id="privacy_form>
					<div class=" rowcl">
					<div class="formControls col-xs-8 col-sm-9">
						<div id="privacy" style="width: 100%; height: 300px;">
						${protocol.privacy!}
						</div>
					</div>
					<div class="footer  pos-f"
						style="bottom: 0; z-index: 20; width: 100%;">
						<div class="row cl"  >
							<button onClick="savePrivacy();"
								class="btn btn-primary radius" type="button">
								<i class="Hui-iconfont">&#xe632;</i> 保存
							</button>
						</div>
					</div>
				</form>
			</div>
		</div>
		<div class="tabCon">
					<div class="page-container">
				<form class="form form-horizontal"	id="play_form">
					<div class=" row cl">
						<div class="form-label col-xs-2 col-sm-2">
							分享标题：
						</div>
						<div class="formControls col-xs-8 col-sm-8">
							<input type="text" id="playTitle" name="playTitle"
										class="input-text radius size-M" value="${protocol.play_title!}">
						</div>
					</div>
					<div class=" row cl">
						<div class="form-label col-xs-2 col-sm-2">
							文字摘要：
						</div>
						<div class="formControls col-xs-8 col-sm-9">
							<input type="text" id="playText" name="playText"
										class="input-text radius size-M" value="${protocol.play_text!}">
						
						</div>
					</div>
					<div class=" row cl">
						<div class="form-label col-xs-2 col-sm-2">
						玩法介绍：
						</div>
						<div class="formControls col-xs-8 col-sm-9">
							<div id="play" style="width: 100%; height: 300px;">
							${protocol.play!}
							</div>
						</div>
					</div>
					<div class="footer  pos-f"
						style="bottom: 0; z-index: 20; width: 100%;">
						<div class="row cl"  >
							<button onClick="savePlay();"
								class="btn btn-primary radius" type="button">
								<i class="Hui-iconfont">&#xe632;</i> 保存
							</button>
						</div>
					</div>
				</form>
			</div>
		</div>
		<div class="tabCon">
		<iframe src="setting/tagMgr"   frameborder="0"   style="position:absolute;bottom:0;;width:100%;height:100%;"></iframe>
		</div>
		<div class="tabCon">
		<iframe src="setting/appStart"   frameborder="0"   style="position:absolute;bottom:0;;width:100%;height:100%;"></iframe>
		</div>
		<div class="tabCon" >
			<iframe src="setting/activity"   frameborder="0"   style="position:absolute;bottom:0;width:100%;height:100%;"></iframe>
		</div>
	</div>
	<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script>
	<script type="text/javascript" src="lib/layer/2.1/layer.js"></script>
	<script type="text/javascript" src="static/h-ui/js/H-ui.js"></script>
	<script type="text/javascript" src="static/h-ui/js/H-ui.admin.js"></script>
	<script type="text/javascript" src="lib/jquery.validation/1.14.0/jquery.validate.min.js"></script>
	<script type="text/javascript" src="lib/jquery.validation/1.14.0/validate-methods.js"></script>
	<script type="text/javascript" src="lib/jquery.validation/1.14.0/messages_zh.min.js"></script>
	<script type="text/javascript" src="lib/wangEditor-2.1.10/dist/js/wangEditor.min.js"></script>	
	<script type="text/javascript">
		var server_pact_editor = null;
		var privacy_editor = null;
		var play_editor = null;
		$(function() {
			
			$.Huitab("#tab_demo .tabBar span", "#tab_demo .tabCon", "current",
					"click", "0");
			
			privacy_editor = createEditor('privacy');
			server_pact_editor = createEditor("server_pact");
			play_editor = createEditor("play");
			
		
		});
		
		function saveServerConfig(){
			if($("#server_config").validate({ignore: ".ignore",
				rules: {
					notice: "digits",
				    one_buddy:"digits",
				    two_buddy:"digits",
				    three_buddy:"digits",
				    map_alce:"digits",
				    map_me:"digits"
			  }}).form()){
				
				var all = parseInt($('#one_buddy').val())+parseInt($('#three_buddy').val())+parseInt($('#two_buddy').val());
				if(all!=100){
					layer.msg('分润系数之和必须为100%！', {
						icon : 2,
						time : 2000
					});
					return;
				}
				
				$.ajax({
					type:"post",
					url:"setting/saveProtocol",
					data:$('#server_config').serialize(),
					beforeSend : function() {
						layer.load(2, {
							zindex : 1200
						});
					},
					success : function(r) {
						layer.closeAll('loading');
						if (r.result == "success") {
							parent.layer.msg('操作成功！', {
								icon : 1,
								time : 2000
							});
						}else {
							layer.msg('操作失败！', {
								icon : 2,
								time : 2000
							});
						}
					}
				})
			}
		}
		
		function saveServerPact(){
			saveColumn({serverPact:server_pact_editor.$txt.html()});
		}
		
		function savePrivacy(){
			saveColumn({privacy:privacy_editor.$txt.html()});
		}
		function savePlay(){
			if($('#playTitle').val().length>15){
				layer.msg('分享标题不超过15字！', {
					icon : 2,
					time : 2000
				});
				return;
			}
				
			if($('#playText').val().length>45){
				layer.msg('文字摘要不超过45字！', {
					icon : 2,
					time : 2000
				});
				return;
			}
				
			saveColumn({play:play_editor.$txt.html(),playTitle:$('#playTitle').val(),playText:$('#playText').val()});
		}
		
		function saveColumn(data){
			$.ajax({
				type:"post",
				url:"setting/saveProtocol",
				data:data,
				beforeSend : function() {
					layer.load(2, {
						zindex : 1200
					});
				},
				success : function(r) {
					layer.closeAll('loading');
					if (r.result == "success") {
						parent.layer.msg('操作成功！', {
							icon : 1,
							time : 2000
						});
					}else {
						layer.msg('操作失败！', {
							icon : 2,
							time : 2000
						});
					}
				}
			})
		}
		
		function createEditor(id){
			var pointer = new wangEditor(id);
			// 自定义菜单
		    pointer.config.menus = [
		                           'source',
		                           '|',
		                           'bold',
		                           'underline',
		                           'italic',
		                           'strikethrough',
		                           'eraser',
		                           'forecolor',
		                           'bgcolor',
		                           '|',
		                           'fontfamily',
		                           'fontsize',
		                           'head',
		                           'alignleft',
		                           'aligncenter',
		                           'alignright',
		                           '|',
		                           'link',
		                           'unlink',
		                           'img',
		                           '|',
		                           'undo',
		                           'redo',
		                           'fullscreen'
		     ];
		    pointer.config.uploadImgUrl = 'common/uploadPictures?type=w';
		    pointer.config.uploadImgFileName = 'picName';
		    pointer.create();
		    return pointer;
		}
		
	</script>
</body>
</html>